<!DOCTYPE html><!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]--><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Node.js Manual TEST - </title><meta name="generator" content="panino-doc-build"><meta name="author" content="Garen J. Torikian"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="./assets/csses/bootstrap.min.css"><link rel="stylesheet" href="./assets/csses/prettify.css"><link rel="stylesheet" href="./assets/csses/refguide_overrides.css"><link href="./assets/images/favicon.ico" rel="icon" type="image/x-icon"><link type="text/css" rel="stylesheet" href="http://yandex.st/highlightjs/6.1/styles/vs.min.css"><script src="./assets/javascripts/jquery.js"></script><script src="./assets/javascripts/clicker.js"></script><script src="./assets/javascripts/jquery.collapse.js"></script><script src="./assets/javascripts/jquery.cookie.js"></script><script src="./assets/javascripts/bootstrap-dropdown.js"></script><script src="./assets/javascripts/jquery-scrollspy.js"></script><script src="./assets/javascripts/prettify-extension.js"></script></head><body><div class="navbar navbar-fixed-top"><div class="navbar-inner"><div id="topSection" class="container"><ul class="nav topLinks"></ul><form id="searchbox" action="" class="navbar-search pull-right"> <input name="query" type="text" placeholder="Search the API" title="Search across all the documentation" class="search-query span3"></form></div></div></div><div id="nonFooter"><div id="wrapper"><div class="content"><div class="row centerpiece"><div id="sidebarContainer" class="span3"><div id="sidebar"><!--include _menu.jade--></div></div><div id="mainContent" class="span9"><div id="documentation"><div class="classContent"><div class="membersBackground"></div><div class=" members pos0"><div class=" membersContent pos0"><h1 class="memberHeader"><span class="name">cluster</span></h1><ul data-tabs="tabs" class="nav tabs pos0"><li data-dropdown="dropdown" class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle"><span>Events (7)</span><b class="caret"></b></a><ul class="dropdown-menu"><li data-id="cluster@death" class="memberLink"><a href="#cluster.death" class="" title="cluster@death (event)" data-id="cluster@death">death</a></li><li data-id="cluster@disconnect" class="memberLink"><a href="#cluster.disconnect" class="" title="cluster@disconnect (event)" data-id="cluster@disconnect">disconnect</a></li><li data-id="cluster@exit" class="memberLink"><a href="#cluster.exit" class="" title="cluster@exit (event)" data-id="cluster@exit">exit</a></li><li data-id="cluster@fork" class="memberLink"><a href="#cluster.fork" class="" title="cluster@fork (event)" data-id="cluster@fork">fork</a></li><li data-id="cluster@listening" class="memberLink"><a href="#cluster.listening" class="" title="cluster@listening (event)" data-id="cluster@listening">listening</a></li><li data-id="cluster@online" class="memberLink"><a href="#cluster.online" class="" title="cluster@online (event)" data-id="cluster@online">online</a></li><li data-id="cluster@setup" class="memberLink"><a href="#cluster.setup" class="" title="cluster@setup (event)" data-id="cluster@setup">setup</a></li></ul></li><li data-dropdown="dropdown" class="dropdown"><ul class="dropdown-menu"></ul></li><li data-dropdown="dropdown" class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle"><span>Functions (3)</span><b class="caret"></b></a><ul class="dropdown-menu"><li data-id="cluster.disconnect" class="memberLink"><a href="#cluster.disconnect" class="" title="cluster.disconnect (class method)" data-id="cluster.disconnect">disconnect</a></li><li data-id="cluster.fork" class="memberLink"><a href="#cluster.fork" class="" title="cluster.fork (class method)" data-id="cluster.fork">fork</a></li><li data-id="cluster.setupMaster" class="memberLink"><a href="#cluster.setupMaster" class="" title="cluster.setupMaster (class method)" data-id="cluster.setupMaster">setupMaster</a></li></ul></li><li data-dropdown="dropdown" class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle"><span>Properties (3)   </span><b class="caret"></b></a><ul class="dropdown-menu"><li data-id="cluster.isMaster" class="memberLink"><a href="#cluster.isMaster" class="" title="cluster.isMaster (class property)" data-id="cluster.isMaster">isMaster</a></li><li data-id="cluster.isWorker" class="memberLink"><a href="#cluster.isWorker" class="" title="cluster.isWorker (class property)" data-id="cluster.isWorker">isWorker</a></li><li data-id="cluster.workers" class="memberLink"><a href="#cluster.workers" class="" title="cluster.workers (class property)" data-id="cluster.workers">workers</a></li></ul></li><li data-dropdown="dropdown" class="dropdown"><ul class="dropdown-menu"></ul></li><li data-dropdown="dropdown" class="dropdown"><ul class="dropdown-menu"></ul></li><li data-dropdown="dropdown" class="dropdown"><ul class="dropdown-menu"></ul></li></ul></div></div><article id="cluster" data-title="cluster (class)" class="article"><blockquote>
<p>1 - Experimental</p>
</blockquote>
<div class="section description"><div class="memberContent"><p>A single instance of Node runs in a single thread. To take advantage of
multi-core systems the user will sometimes want to launch a cluster of Node
processes to handle the load.</p>
<p>To use this module, add <code>require(&#39;cluster&#39;)</code> to your code.</p>
<div class="alert alert-success"><h4 class="alert-heading">Note: </h4>This feature was introduced recently, and may change in future versions. Please try it out and provide feedback.</div>
<h5>How It Works</h5>
<p>Worker processes are spawned using the <a href="child_process.html#child_process.fork" class="link-short" title="child_process.fork (class method)" data-id="child_process.fork">fork</a> method,
so that they can communicate with the parent via IPC and pass server
handles back and forth.</p>
<p>When you call <code>server.listen(...)</code> in a worker, it serializes the
arguments and passes the request to the master process.  If the master
process already has a listening server matching the worker&#39;s
requirements, it passes the handle to the worker.  If it does not
already have a listening server matching that requirement, it creates one,
and passes the handle to the child.</p>
<p>This causes potentially surprising behavior in three edge cases:</p>
<ol>
<li><code>server.listen({fd: 7})</code>: Because the message is passed to the master,
file descriptor 7 <strong>in the parent</strong> will be listened on, and the
handle passed to the worker, rather than listening to the worker&#39;s
idea of what the number 7 file descriptor references.</li>
<li><code>server.listen(handle)</code>: Listening on handles explicitly will cause
the worker to use the supplied handle, rather than talk to the master
process.  If the worker already has the handle, then it&#39;s presumed
that you know what you are doing.</li>
<li><code>server.listen(0)</code>: Normally, this will case servers to listen on a
random port.  However, in a cluster, each worker will receive the
same &quot;random&quot; port each time they do <code>listen(0)</code>.  In essence, the
port is random the first time, but predictable thereafter.  If you
want to listen on a unique port, generate a port number based on the
cluster worker ID.</li>
</ol>
<p>When multiple processes are all <code>accept()</code>ing on the same underlying
resource, the operating system load-balances across them very
efficiently.  There is no routing logic in Node.js, or in your program,
and no shared state between the workers.  Therefore, it is important to
design your program such that it does not rely too heavily on in-memory
data objects for things like sessions and login.</p>
<p>Because workers are all separate processes, they can be killed or
re-spawned depending on your program&#39;s needs, without affecting other
workers.  As long as there are some workers still alive, the server will
continue to accept connections.  Node does not automatically manage the
number of workers for you, however.  It is your responsibility to manage
the worker pool for your application&#39;s needs.</p>
<h4>Example: Launching one cluster working for each CPU</h4>
<p>The cluster module allows you to easily create a network of processes that all
share server ports.</p>
<p>Create a file called <em>server.js</em> and paste the following code:</p>
<script src='http://snippets.c9.io/github.com/c9/nodemanual.org-examples/nodejs_ref_guide/cluster/server.js?linestart=3&lineend=0&showlines=false' defer='defer'></script>

<p>By launching <em>server.js</em> with the Node.js REPL, you can see that the workers are
sharing the HTTP port 8000:</p>
<pre><code>% node <span class="filename">server.js
Worker 2438 online
Worker 2437 online</code></pre>
<h4>Example: Message passing between clusters and the master process</h4>
<script src='http://snippets.c9.io/github.com/c9/nodemanual.org-examples/nodejs_ref_guide/cluster/cluster.js?linestart=3&lineend=0&showlines=false' defer='defer'></script></div></div><div class="section subclasses"><!-- h3 <Subclasses></Subclasses><div class="memberContent"><ul class="method-list"><li><a href="#worker" class="" title="worker (class)" data-id="worker">worker</a></li></ul></div>--></div></article><h3 class="sectionHeader">Events</h3><article id="cluster.event.death" data-title="cluster@death (event)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span class="eventObjName">cluster</span><span class="eventListenerStart">.on("</span><span id="cluster.death" class="member-name eventMember methodClicker">death</span></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster@death" class="ellipsis_description"><p>When any of the workers die, the cluster module emits this event. This can be
used to restart the worker by calling <a href="#cluster.fork" class="link-short" title="cluster.fork (class method)" data-id="cluster.fork">fork</a> again.</p>
</div><div id="short_cluster@death" class="short_description hiddenSpan"><p>When any of the workers die, the cluster module emits this event. This can be
used to restart the worker by calling <a href="#cluster.fork" class="link-short" title="cluster.fork (class method)" data-id="cluster.fork">fork</a> again.</p>
<p>Different techniques can be used to restart the worker, depending on the
application.</p>
<h4>Example</h4>
<script src='http://snippets.c9.io/github.com/c9/nodemanual.org-examples/nodejs_ref_guide/cluster/cluster.death.js?linestart=3&lineend=0&showlines=false' defer='defer'></script></div><h3 id="cluster@death" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><p>Different techniques can be used to restart the worker, depending on the
application.</p>
<h4>Arguments</h4><table class="argumentTable argument-list table table-striped table-bordered"><tr class="argumentRow "><td class="argName ">worker</td><td class="argType" "><a href="#cluster" class="" title="cluster (class)" data-id="cluster">cluster</a></td><td class="argDescription ">Required. The dying worker in the cluster</td></tr></table></div></div></div></div></article><article id="cluster.event.disconnect" data-title="cluster@disconnect (event)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span class="eventObjName">cluster</span><span class="eventListenerStart">.on("</span><span id="cluster.disconnect" class="member-name eventMember methodClicker">disconnect</span></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster@disconnect" class="ellipsis_description"><p>When a worker&#39;s IPC channel has disconnected, this event is emitted. This
happens when the worker dies, usually after calling <a href="#worker.destroy" class="link-short" title="worker.destroy (class method)" data-id="worker.destroy">destroy</a>.</p>
</div><div id="short_cluster@disconnect" class="short_description hiddenSpan"><p>When a worker&#39;s IPC channel has disconnected, this event is emitted. This
happens when the worker dies, usually after calling <a href="#worker.destroy" class="link-short" title="worker.destroy (class method)" data-id="worker.destroy">destroy</a>.</p>
<p>When calling <code>disconnect()</code>, there may be a delay between the <code>disconnect</code> and
<code>death</code> events.  This event can be used to detect if the process is stuck in a
cleanup or if there are long-living connections.</p>
<h4>Example</h4>
<pre><code>cluster.<span class="keyword">on</span>(<span class="comment">'disconnect', function(worker) {</span>
  console.<span class="built_in">log</span>(<span class="comment">'The worker #' + worker.uniqueID + ' has disconnected');</span>
});</code></pre>
</div><h3 id="cluster@disconnect" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><p>When calling <code>disconnect()</code>, there may be a delay between the <code>disconnect</code> and
<code>death</code> events.  This event can be used to detect if the process is stuck in a
cleanup or if there are long-living connections.</p>
<h4>Arguments</h4><table class="argumentTable argument-list table table-striped table-bordered"><tr class="argumentRow "><td class="argName ">worker</td><td class="argType" "><a href="#worker" class="" title="worker (class)" data-id="worker">worker</a></td><td class="argDescription ">Required. The worker that disconnected</td></tr></table></div></div></div></div></article><article id="cluster.event.exit" data-title="cluster@exit (event)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span class="eventObjName">cluster</span><span class="eventListenerStart">.on("</span><span id="cluster.exit" class="member-name eventMember methodClicker">exit</span></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster@exit" class="ellipsis_description"><p>When any of the workers die, the cluster module emits the &#39;exit&#39; event.
This can be used to restart the worker by calling <code>fork()</code> again.</p>
</div><div id="short_cluster@exit" class="short_description hiddenSpan"><p>When any of the workers die, the cluster module emits the &#39;exit&#39; event.
This can be used to restart the worker by calling <code>fork()</code> again.</p>
<pre><code>cluster.<span class="keyword">on</span>(<span class="comment">'exit', function(worker, code, signal) {</span>
  var exitCode = worker.process.exitCode;
  console.<span class="built_in">log</span>(<span class="comment">'worker ' + worker.process.pid + ' died ('+exitCode+'). restarting...');</span>
  cluster.fork();
});</code></pre>
</div><h3 id="cluster@exit" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><pre><code>cluster.<span class="keyword">on</span>(<span class="comment">'exit', function(worker, code, signal) {</span>
  var exitCode = worker.process.exitCode;
  console.<span class="built_in">log</span>(<span class="comment">'worker ' + worker.process.pid + ' died ('+exitCode+'). restarting...');</span>
  cluster.fork();
});</code></pre>
<h4>Arguments</h4><table class="argumentTable argument-list table table-striped table-bordered"><tr class="argumentRow "><td class="argName ">worker</td><td class="argType" "><a href="#worker" class="" title="worker (class)" data-id="worker">worker</a></td><td class="argDescription ">Required. The worker object</td></tr><tr class="argumentRow "><td class="argName ">code</td><td class="argType" "><a href="http://www.nodemanual.org/latest/js_doc/Number.html" class="" title="Number" data-id="Number">Number</a></td><td class="argDescription ">Required. The exit code, if it exited normally</td></tr><tr class="argumentRow "><td class="argName ">signal</td><td class="argType" "><a href="http://www.nodemanual.org/latest/js_doc/String.html" class="" title="String" data-id="String">String</a></td><td class="argDescription ">Required. The name of the signal (eg. <code>&#39;SIGHUP&#39;</code>) that caused the process to be killed.</td></tr></table></div></div></div></div></article><article id="cluster.event.fork" data-title="cluster@fork (event)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span class="eventObjName">cluster</span><span class="eventListenerStart">.on("</span><span id="cluster.fork" class="member-name eventMember methodClicker">fork</span></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster@fork" class="ellipsis_description"><p>When a new worker is forked the cluster module will emit a &#39;fork&#39; event. This
can be used to log worker activity, and create you own timeout.</p>
</div><div id="short_cluster@fork" class="short_description hiddenSpan"><p>When a new worker is forked the cluster module will emit a &#39;fork&#39; event. This
can be used to log worker activity, and create you own timeout.</p>
<h4>Example</h4>
<pre><code><span class="keyword">var</span> timeouts = [];
<span class="keyword">var</span> errorMsg = <span class="function"><span class="keyword">function</span> <span class="params">()</span> <span class="comment">{
  console.error("Something must be wrong with the connection ...");
}</span>);</span>

cluster.<span class="keyword">on</span>(<span class="string">'fork'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(worker)</span> <span class="comment">{
  timeouts[worker.uniqueID] = setTimeout(errorMsg, 2000);
}</span>);</span>
cluster.<span class="keyword">on</span>(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(worker)</span> <span class="comment">{
  clearTimeout(timeouts[worker.uniqueID]);
}</span>);</span>
cluster.<span class="keyword">on</span>(<span class="string">'death'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(worker)</span> <span class="comment">{
  clearTimeout(timeouts[worker.uniqueID]);
  errorMsg();
}</span>);</span></code></pre>
</div><h3 id="cluster@fork" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><h4>Arguments</h4><table class="argumentTable argument-list table table-striped table-bordered"><tr class="argumentRow "><td class="argName ">worker</td><td class="argType" "><a href="#worker" class="" title="worker (class)" data-id="worker">worker</a></td><td class="argDescription ">Required. The worker that was forked</td></tr></table></div></div></div></div></article><article id="cluster.event.listening" data-title="cluster@listening (event)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span class="eventObjName">cluster</span><span class="eventListenerStart">.on("</span><span id="cluster.listening" class="member-name eventMember methodClicker">listening</span></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster@listening" class="ellipsis_description"><p>When calling <code>listen()</code> from a worker, a &#39;listening&#39; event is automatically assigned
to the server instance. When the server is listening, a message is sent to the master
where the &#39;listening&#39; event is emitted.</p>
</div><div id="short_cluster@listening" class="short_description hiddenSpan"><p>When calling <code>listen()</code> from a worker, a &#39;listening&#39; event is automatically assigned
to the server instance. When the server is listening, a message is sent to the master
where the &#39;listening&#39; event is emitted.</p>
<h4>Example</h4>
<p>The event handler is executed with two arguments, the <code>worker</code> contains the
worker object and the <code>address</code> object contains the following connection properties:
<code>address</code>, <code>port</code> and <code>addressType</code>. This is very useful if the worker is
listening on more than one address.</p>
<pre><code>cluster.<span class="keyword">on</span>(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(worker, address)</span> <span class="comment">{
  console.log("A worker is now connected to " + address.address + ":" + address.port);
}</span>);</span></code></pre>
</div><h3 id="cluster@listening" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><h4>Arguments</h4><table class="argumentTable argument-list table table-striped table-bordered"><tr class="argumentRow "><td class="argName ">worker</td><td class="argType" "><a href="#worker" class="" title="worker (class)" data-id="worker">worker</a></td><td class="argDescription ">Required. The worker to listen for</td></tr><tr class="argumentRow "><td class="argName ">address</td><td class="argType" "><a href="http://www.nodemanual.org/latest/js_doc/Object.html" class="" title="Object" data-id="Object">Object</a></td><td class="argDescription ">Required. Contains the <code>address</code> and <code>port</code> information where the worker is listening</td></tr></table></div></div></div></div></article><article id="cluster.event.online" data-title="cluster@online (event)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span class="eventObjName">cluster</span><span class="eventListenerStart">.on("</span><span id="cluster.online" class="member-name eventMember methodClicker">online</span></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster@online" class="ellipsis_description"><p>After forking a new worker, the worker should respond with a online message.
When the master receives a online message it emits this event.</p>
</div><div id="short_cluster@online" class="short_description hiddenSpan"><p>After forking a new worker, the worker should respond with a online message.
When the master receives a online message it emits this event.</p>
<p>The difference between <code>&#39;fork&#39;</code> and <code>&#39;online&#39;</code> is that fork is emitted when the
master tries to fork a worker, and <code>&#39;online&#39;</code> is emitted when the worker is
being executed.</p>
<h4>Example</h4>
<pre><code>cluster.<span class="keyword">on</span>(<span class="string">'online'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(worker)</span> <span class="comment">{
  console.log("Yay, the worker responded after it was forked");
}</span>);</span></code></pre>
</div><h3 id="cluster@online" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><p>The difference between <code>&#39;fork&#39;</code> and <code>&#39;online&#39;</code> is that fork is emitted when the
master tries to fork a worker, and <code>&#39;online&#39;</code> is emitted when the worker is
being executed.</p>
<h4>Arguments</h4><table class="argumentTable argument-list table table-striped table-bordered"><tr class="argumentRow "><td class="argName ">worker</td><td class="argType" "><a href="#worker" class="" title="worker (class)" data-id="worker">worker</a></td><td class="argDescription ">Required. The worker that becomes online</td></tr></table></div></div></div></div></article><article id="cluster.event.setup" data-title="cluster@setup (event)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span class="eventObjName">cluster</span><span class="eventListenerStart">.on("</span><span id="cluster.setup" class="member-name eventMember methodClicker">setup</span></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster@setup" class="ellipsis_description"><p>When the <a href="#cluster.setupMaster" class="link-short" title="cluster.setupMaster (class method)" data-id="cluster.setupMaster">setupMaster</a> function has been executed this
event emits. If <a href="#cluster.setupMaster" class="link-short" title="cluster.setupMaster (class method)" data-id="cluster.setupMaster">setupMaster</a> was not executed before <a href="#cluster.fork" class="link-short" title="cluster.fork (class method)" data-id="cluster.fork">fork</a>, this function
calls <code>setupMaster()</code> with no arguments.</p>
</div><div id="short_cluster@setup" class="short_description hiddenSpan"><p>When the <a href="#cluster.setupMaster" class="link-short" title="cluster.setupMaster (class method)" data-id="cluster.setupMaster">setupMaster</a> function has been executed this
event emits. If <a href="#cluster.setupMaster" class="link-short" title="cluster.setupMaster (class method)" data-id="cluster.setupMaster">setupMaster</a> was not executed before <a href="#cluster.fork" class="link-short" title="cluster.fork (class method)" data-id="cluster.fork">fork</a>, this function
calls <code>setupMaster()</code> with no arguments.</p>
</div><h3 id="cluster@setup" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><h4>Arguments</h4><table class="argumentTable argument-list table table-striped table-bordered"><tr class="argumentRow "><td class="argName ">worker</td><td class="argType" "><a href="#worker" class="" title="worker (class)" data-id="worker">worker</a></td><td class="argDescription ">Required. The worker that executed</td></tr></table></div></div></div></div></article><h3 class="sectionHeader">Methods</h3><article id="cluster.disconnect" data-title="cluster.disconnect (class method)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span id="cluster.disconnect" class="member-name methodClicker"><span class="sigClassName">cluster.</span><span class="sigMemberName">disconnect</span></span></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster.disconnect" class="ellipsis_description"><p>When calling this method, all workers will commit a graceful suicide. After they
are disconnected, all internal handlers will be closed, allowing the master
process to die graceful if no other event is waiting.</p>
</div><div id="short_cluster.disconnect" class="short_description hiddenSpan"><p>When calling this method, all workers will commit a graceful suicide. After they
are disconnected, all internal handlers will be closed, allowing the master
process to die graceful if no other event is waiting.</p>
</div><h3 id="cluster.disconnect" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><h4>Arguments</h4><table class="argumentTable argument-list table table-striped table-bordered"><tr class="argumentRow "><td class="argName ">callback</td><td class="argType" "><a href="http://www.nodemanual.org/latest/js_doc/Function.html" class="" title="Function" data-id="Function">Function</a></td><td class="argDescription ">Required. Called when all workers are disconnected and handlers are closed</td></tr></table></div></div></div></div></article><article id="cluster.fork" data-title="cluster.fork (class method)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span id="cluster.fork" class="member-name methodClicker"><span class="sigClassName">cluster.</span><span class="sigMemberName">fork</span></span><li class="signature-returns"><ul class="argument-types"><li class="argument-type"><a href="#worker" class="returnType " title="worker (class)" data-id="worker">worker</a></li></ul></li></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster.fork" class="ellipsis_description"><p>Spawns a new worker process. This can only be called from the master process.</p>
</div><div id="short_cluster.fork" class="short_description hiddenSpan"><p>Spawns a new worker process. This can only be called from the master process.</p>
</div><h3 id="cluster.fork" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><h4>Arguments</h4><table class="argumentTable argument-list table table-striped table-bordered"><tr class="argumentRow "><td class="argName ">env</td><td class="argType" "><a href="http://www.nodemanual.org/latest/js_doc/Object.html" class="" title="Object" data-id="Object">Object</a></td><td class="argDescription ">Required. Additional key/value pairs to add to child process environment.</td></tr></table></div></div></div></div></article><article id="cluster.setupMaster" data-title="cluster.setupMaster (class method)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span id="cluster.setupMaster" class="member-name methodClicker"><span class="sigClassName">cluster.</span><span class="sigMemberName">setupMaster</span></span></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster.setupMaster" class="ellipsis_description"><p><code>setupMaster</code> is used to change the default <code>&#39;fork&#39;</code> behavior. It takes one
option object argument.</p>
</div><div id="short_cluster.setupMaster" class="short_description hiddenSpan"><p><code>setupMaster</code> is used to change the default <code>&#39;fork&#39;</code> behavior. It takes one
option object argument.</p>
<h4>Example</h4>
<pre><code>var cluster = require(<span class="string">"cluster"</span>)<span class="comment">;</span>
cluster<span class="preprocessor">.setupMaster</span>({
  exec : <span class="string">"worker.js"</span>,
  args : [<span class="string">"--use"</span>, <span class="string">"https"</span>],
  silent : true
})<span class="comment">;</span>
cluster<span class="preprocessor">.fork</span>()<span class="comment">;</span></code></pre>
</div><h3 id="cluster.setupMaster" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><h4>Arguments</h4><table class="argumentTable argument-list table table-striped table-bordered"><tr class="argumentRow "><td class="argName ">settings</td><td class="argType" "><a href="http://www.nodemanual.org/latest/js_doc/Object.html" class="" title="Object" data-id="Object">Object</a></td><td class="argDescription ">Required. Various settings to configure. The properties on this parameter are:  <code>exec</code>, the <a href="http://www.nodemanual.org/latest/js_doc/String.html" class="link-short" title="<code>String</code>" data-id="<code>String</code>">undefined</a> file path to worker file. The default is <code>__filename</code>.  <code>args</code>, an <a href="http://www.nodemanual.org/latest/js_doc/Array.html" class="link-short" title="<code>Array</code>" data-id="<code>Array</code>">undefined</a> of string arguments passed to worker. The default is <code>process.argv.slice(2)</code>.  <code>silent</code>, <a href="http://www.nodemanual.org/latest/js_doc/Boolean.html" class="link-short" title="<code>Boolean</code>" data-id="<code>Boolean</code>">undefined</a> specifying whether or not to send output to parent&#39;s stdio. The default is <code>false</code>.</td></tr></table></div></div></div></div></article><h3 class="sectionHeader">Properties</h3><article id="cluster.isMaster" data-title="cluster.isMaster (class property)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span id="cluster.isMaster" class="member-name methodClicker"><span class="sigClassName">cluster.</span><span class="sigMemberName">isMaster</span></span><li class="signature-returns"><ul class="argument-types"><li class="argument-type"><a href="http://www.nodemanual.org/latest/js_doc/Boolean.html" class="returnType " title="Boolean" data-id="Boolean">Boolean</a></li></ul></li></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster.isMaster" class="ellipsis_description"><p>Flag to determine if the current process is a master process in a cluster. A
process is a master if <code>process.env.NODE_WORKER_ID</code> is undefined.</p>
</div><div id="short_cluster.isMaster" class="short_description hiddenSpan"><p>Flag to determine if the current process is a master process in a cluster. A
process is a master if <code>process.env.NODE_WORKER_ID</code> is undefined.</p>
</div><h3 id="cluster.isMaster" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"></div></div></div></div></article><article id="cluster.isWorker" data-title="cluster.isWorker (class property)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span id="cluster.isWorker" class="member-name methodClicker"><span class="sigClassName">cluster.</span><span class="sigMemberName">isWorker</span></span><li class="signature-returns"><ul class="argument-types"><li class="argument-type"><a href="http://www.nodemanual.org/latest/js_doc/Boolean.html" class="returnType " title="Boolean" data-id="Boolean">Boolean</a></li></ul></li></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster.isWorker" class="ellipsis_description"><p>Flag to determine if the current process is a worker process in a cluster. A
process is a worker if <code>process.env.NODE_WORKER_ID</code> is defined.</p>
</div><div id="short_cluster.isWorker" class="short_description hiddenSpan"><p>Flag to determine if the current process is a worker process in a cluster. A
process is a worker if <code>process.env.NODE_WORKER_ID</code> is defined.</p>
</div><h3 id="cluster.isWorker" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"></div></div></div></div></article><article id="cluster.workers" data-title="cluster.workers (class property)" class="article"><div class="section method"><div class="memberContent"><div class="title"><ul class="signatures"><li class="signature"><ul><li class="signature-call"><span id="cluster.workers" class="member-name methodClicker"><span class="sigClassName">cluster.</span><span class="sigMemberName">workers</span></span><li class="signature-returns"><ul class="argument-types"><li class="argument-type"><a href="http://www.nodemanual.org/latest/js_doc/Object.html" class="returnType " title="Object" data-id="Object">Object</a></li></ul></li></li></ul><ul class="metaInfo"></ul></li></ul></div><div class="sideToggler"><div id="ellipsis_cluster.workers" class="ellipsis_description"><p>A hash that stores the active worker objects, keyed by <code>id</code> field.
This makes it easy to loop through all the workers, like this:</p>
</div><div id="short_cluster.workers" class="short_description hiddenSpan"><p>A hash that stores the active worker objects, keyed by <code>id</code> field.
This makes it easy to loop through all the workers, like this:</p>
<pre><code><span class="comment">// Go through all workers</span>
<span class="function"><span class="keyword">function</span> <span class="title">eachWorker</span><span class="params">(callback)</span> {</span>
  <span class="keyword">for</span> (<span class="keyword">var</span> uniqueID <span class="keyword">in</span> cluster.workers) {
    callback(cluster.workers[uniqueID]);
  }
}
eachWorker(<span class="function"><span class="keyword">function</span> <span class="params">(worker)</span> {</span>
  worker.send(<span class="string">'big announcement to all workers'</span>);
});</code></pre>
<p>Should you wish to reference a worker over a communication channel, using the
worker&#39;s uniqueID is the easiest way to find the worker:</p>
<pre><code><span class="title">socket</span>.on('<span class="typedef"><span class="keyword">data</span>', function <span class="container">(<span class="title">uniqueID</span>)</span> <span class="container">{
  <span class="title">var</span> <span class="title">worker</span> = <span class="title">cluster</span>.<span class="title">workers</span>[<span class="title">uniqueID</span>];
}</span>);</span></code></pre>
</div><h3 id="cluster.workers" class="methodToggle methodClicker inactive">&nbsp;&nbsp;&nbsp;</h3><div class="description"><pre><code><span class="comment">// Go through all workers</span>
<span class="function"><span class="keyword">function</span> <span class="title">eachWorker</span><span class="params">(callback)</span> {</span>
  <span class="keyword">for</span> (<span class="keyword">var</span> uniqueID <span class="keyword">in</span> cluster.workers) {
    callback(cluster.workers[uniqueID]);
  }
}
eachWorker(<span class="function"><span class="keyword">function</span> <span class="params">(worker)</span> {</span>
  worker.send(<span class="string">'big announcement to all workers'</span>);
});</code></pre>
<p>Should you wish to reference a worker over a communication channel, using the
worker&#39;s uniqueID is the easiest way to find the worker:</p>
<pre><code><span class="title">socket</span>.on('<span class="typedef"><span class="keyword">data</span>', function <span class="container">(<span class="title">uniqueID</span>)</span> <span class="container">{
  <span class="title">var</span> <span class="title">worker</span> = <span class="title">cluster</span>.<span class="title">workers</span>[<span class="title">uniqueID</span>];
}</span>);</span></code></pre>
</div></div></div></div></article></div></div><div id="disqus_thread"></div></div></div></div></div><div class="push"></div></div><div id="footer"><div class="footerInner"><div class="footer-text">&#169; 2012:</div></div></div><!-- scripts concatenated and minified via ant build script--><script defer src="./assets/javascripts/plugins.js"></script>
<script defer src="./assets/javascripts/prettify.js"></script>
<script defer src="./assets/javascripts/prettify-extension.js"></script>
<script defer src="./assets/javascripts/ux.js"></script><!-- end scripts--><!--[if lt IE 7]><script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script><script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})
</script><![endif]--></body></html>